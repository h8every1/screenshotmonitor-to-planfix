# screesnshotmonitor to planfix

Перенос данных и скриншотов о работе в screenshotmonitor-е в планфикс в виде комментариев к задачам с прикреплённой
аналитикой.

Для хранения файлов скриншотов используется dropbox

## Сборка и запуск

Сборка для linux/amd54:

```shell
task build
```

Создаст исполняемый файл `bin/sm-planfix-linux-amd64`

Для запуска необходим файл конфигурации, лежащий в `config/config.yml` рядом с бинарником программы. Пример файла можно
посмотреть в [примере](config.example.yml).

Запуск через созданый бинарный файл. Стоит поставить в ежедневный крон.

```shell
sm-planfix-linux-amd64 -config=/var/www/planfix/config.yml [-start=2022-04-08] [-end=2022-04-10]
```

### Ключи
`start` - с какого дня получать активности из screenshotmonitor
`end` - до какого дня получать активности (не вкючительно)

По умолчанию получаются активности за вчерашний день.

## Принцип работы

Перебираются активности (activities) пользователя со screenshotmonitor.com за вчерашний день. В описании активности
ищется хэш с id задачи в планфиксе. Например

```
#1234 исправление бага
```

или

```
разработка фичи #1234
```

ID может быть как номером задачи, так и внутренним id планфикса

Для каждой активности скачиваются файлы скриншотов и копируются в одну папку в дропбоксе и создаётся ссылка на неё.

Далее внутрь выбранной задачи планфикса добавляется комментарий с прикреплённой аналитикой, внутри которой заполнено
поле со ссылкой на папку в дропбоксе

## Ссылки

* [Screenshotmonitor API doc](https://screenshotmonitor.com/apidoc)
* [Planfix API doc](https://help.planfix.com/ru/Список_функций)
* [Bitly API ref](https://dev.bitly.com/api-reference)
* [golang dropbox simple api](https://github.com/tj/go-dropbox)